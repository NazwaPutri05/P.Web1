<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lowongan Kerja</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h2>Manajemen Lowongan Kerja</h2>

        <!-- Form untuk menambah/update lowongan -->
        <form id="lowonganForm" class="mb-4">
            <div class="form-group">
                <label for="kode">Kode Lowongan :</label>
                <input type="text" class="form-control" id="kode" required>
            </div>
            <div class="form-group">
                <label for="judul">Judul Lowongan :</label>
                <input type="text" class="form-control" id="judul" required>
            </div>
            <div class="form-group">
                <label for="deskripsi">Deskripsi :</label>
                <input type="text" class="form-control" id="deskripsi" required>
            </div>
            <div class="form-group">
                <label for="perusahaan">Perusahaan :</label>
                <input type="text" class="form-control" id="perusahaan" required>
            </div>
            <div class="form-group">
                <label for="tanggal">Tanggal Diterbitkan :</label>
                <input type="date" class="form-control" id="tanggal" required>
            </div>
            <div class="form-group">
                <label for="status">Status :</label>
                <input type="text" class="form-control" id="status" required>
            </div>
            <button type="submit" class="btn btn-primary" id="submitBtn">Tambah Lowongan</button>
        </form>

        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Kode</th>
                    <th>Judul</th>
                    <th>Deskripsi</th>
                    <th>Perusahaan</th>
                    <th>Tanggal Diterbitkan</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="lowonganTable">
            </tbody>
        </table>
    </div>

    <script>
        $(document).ready(function() {
            const url = 'https://script.google.com/macros/s/AKfycbx8G-lEsgCe64raia3G7CZCoCR46Mnx47GDAKfmn3bXiockzUSl0oM8YFqfS0Fau3za/exec';

            loadLowongan();

            // Handle form submit for insert or update
            $('#lowonganForm').on('submit', function(event) {
                event.preventDefault();
                const kode = $('#kode').val();
                const judul = $('#judul').val();
                const deskripsi = $('#deskripsi').val();
                const perusahaan = $('#perusahaan').val();
                const tanggal = $('#tanggal').val();
                const status = $('#status').val();

                $.ajax({
                    url: url,
                    type: "GET",
                    dataType: "json",
                    data: {
                        action: 'insert',
                        kode: kode,
                        judul: judul,
                        deskripsi: deskripsi,
                        perusahaan: perusahaan,
                        tanggal_diterbitkan: tanggal,
                        status: status
                    },
                    success: function(response) {
                        alert(response.result);
                        loadLowongan(); // Reload lowongan setelah insert
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.error("Request failed:", textStatus, errorThrown);
                    }
                });
            });

            function loadLowongan() {
                $.ajax({
                    url: url,
                    type: "GET",
                    data: { action: "read" },
                    dataType: "json",
                    success: function(response) {
                        const tbody = $('#lowonganTable');
                        tbody.empty();
                        response.forEach(function(item) {
                            tbody.append(`
                                <tr>
                                    <td>${item.Kode}</td>
                                    <td>${item.Judul}</td>
                                    <td>${item.Deskripsi}</td>
                                    <td>${item.Perusahaan}</td>
                                    <td>${item.Tanggal_Diterbitkan}</td>
                                    <td>${item.Status}</td>
                                </tr>
                            `);
                        });
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.error("Request failed:", textStatus, errorThrown);
                    }
                });
            }
        });
    </script>
</body>
</html>